services:
  - type: web
    name: servicioshogar-backend
    env: node
    plan: free
    branch: main
    buildCommand: |
      echo "=== Frontend and Backend Build ==="
      
      # Build frontend
      echo "Building frontend..."
      cd frontend
      npm ci
      npm run build
      cd ..
      
      # Build backend
      echo "Building backend..."
      cd backend
      npm ci
      npm run build
      
      # Copy frontend files with verification
      echo "Copying frontend files..."
      mkdir -p frontend-dist
      cp -r ../frontend/dist/* ./frontend-dist/
      
      # Verify copy worked
      if [ ! -f "./frontend-dist/index.html" ]; then
        echo "ERROR: Frontend copy verification failed"
        ls -la frontend-dist/ || echo "frontend-dist directory not found"
        exit 1
      fi
      
      echo "Build completed successfully"
      ls -la frontend-dist/
    startCommand: cd backend && npm start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        sync: false
      - key: PORT
        value: 10000
      - key: VAPID_PUBLIC_KEY
        sync: false
      - key: VAPID_PRIVATE_KEY
        sync: false
      - key: VAPID_EMAIL
        sync: false
      - key: SESSION_SECRET
        sync: false

